// datasource + generator
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}



// ---------- Models ----------
model User {
  id        String      @id @default(uuid()) @db.Uuid
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  // Relationships
  sessions  Session[]
  profile    Profile?

  // For future auth fields (email, provider IDs, etc.)
  // email     String?   @unique
}


model Profile {
  id         String   @id @default(uuid()) @db.Uuid
 createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Owner (exactly one must be set)
  sessionId String?  @db.Uuid
  userId    String?  @db.Uuid

  session   Session? @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Portfolio header content
  displayName String?         // e.g., "Luis Alarcón"
  headline    String?         // e.g., "Product-minded SWE"
  location    String?
  bio         String?         // 2–3 sentence summary
  avatarUrl   String?

  // Keep simple as arrays/JSON for MVP
  skills      String[] @db.Text
  links       Json      // {email, github, linkedin, website, twitter, ...}

  // uniqueness: one profile per owner
  @@unique([sessionId])
  @@unique([userId])
}

model Experience {
  id        String     @id @default(uuid()) @db.Uuid
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  // MVP: tie experiences only to sessions
  sessionId String     @db.Uuid
  session   Session    @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  // RELATIONSHIP TO PLACEMENTS
  // This defines the "other side" of the Placement.experience relationship
  placements Placement[]

  title     String
  summary   String?
  start     DateTime?
  end       DateTime?
  kind      String   @db.Text @default("other")

  @@index([sessionId])
  @@index([kind])
  @@index([title])
}



model Session {
  id        String     @id @default(uuid()) @db.Uuid
  createdAt DateTime   @default(now())
  claimedByUserId String? @db.Uuid
  claimedBy   User?    @relation(fields: [claimedByUserId], references: [id], onDelete: SetNull)

  experiences Experience[]
  layouts      Layout[]   // <- singular

  profile Profile?

  @@index([claimedByUserId])
}

model Layout {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sessionId String   @db.Uuid
  session   Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  LayoutId  String   @default  ("home")

  slots Slot[]
  placements Placement[]

  @@unique([sessionId, LayoutId])
  @@index([LayoutId])
}

model Placement {
  id     String     @id @default(uuid()) @db.Uuid // Db internal 
  createdAt   DateTime  @default(now())

  layoutId  String  @db.Uuid
  layout    Layout  @relation(fields: [layoutId], references: [id], onDelete: Cascade)

  // RELATIONAL LINK
  experienceId String     @db.Uuid
  experience   Experience @relation(fields: [experienceId], references: [id], onDelete: Cascade)

  // HUMAN READABLE KEYS (What the user edits in JSON)
  slotId       String     // e.g., "header-slot"
  patternId    String     // e.g., "hero-banner"

  @@index([layoutId])
}

model Slot{
  id  String  @id @default(uuid())  @db.Uuid
  layoutId    String  @db.Uuid
  layout   Layout   @relation(fields: [layoutId], references: [id], onDelete: Cascade)

  clientSlotId String //  e.g., "slot-1", "header" from your JSON
  area         String // e.g., "sidebar"

  @@index([layoutId])
}


