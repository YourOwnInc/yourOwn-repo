// datasource + generator
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}



// ---------- Models ----------
model User {
  id        String      @id @default(uuid()) @db.Uuid
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  // Relationships
  sessions  Session[]
  profile    Profile?

  // For future auth fields (email, provider IDs, etc.)
  // email     String?   @unique
}


model Profile {
  id         String   @id @default(uuid()) @db.Uuid
 createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Owner (exactly one must be set)
  sessionId String?  @db.Uuid
  userId    String?  @db.Uuid

  session   Session? @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Portfolio header content
  displayName String?         // e.g., "Luis Alarcón"
  headline    String?         // e.g., "Product-minded SWE"
  location    String?
  bio         String?         // 2–3 sentence summary
  avatarUrl   String?

  tagline          String?
  bioShort         String? @db.Text
  bioLong          String? @db.Text
  philosophy       String? @db.Text
  currentlyLearning String[]
  interests        String[]


  placements Placement[]      // relationship with placement

  // Keep simple as arrays/JSON for MVP
  skills      String[] @db.Text
  links       Json      // {email, github, linkedin, website, twitter, ...}

  // uniqueness: one profile per owner
  @@unique([sessionId])
  @@unique([userId])
}

enum ExperienceType {
  WORK
  PROJECT
  EVENT
  ORGANIZATION
  COLLECTION // For photo sets, galleries, etc.
  VOLUNTEER
}

model Experience {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // CORE DATA (The "Facts")
  title        String         @default("experience")
  type         ExperienceType @default(WORK)
  startDate    DateTime?
  endDate      DateTime?
  isCurrent    Boolean   @default(false)

  // EXTENDED CONTENT (The "Kitchen Sink")
  // These fields allow you to store all "ways of talking" in one place [cite: 14, 15]
  roleTitle        String?
  organization     String?
  location         String?
  summaryShort     String?   @db.Text
  summaryLong      String?   @db.Text
  problemStatement String?   @db.Text
  solutionDetails  String?   @db.Text
  impactBullets    String[]  // Array of achievements/points
  techStack        String[]  // Array of technologies used
  
  // RELATIONSHIPS
  // Keeping narratives for future-proofing, though you'll use the flat fields for now 
  narratives Narrative[]
  sessionId String    @db.Uuid
  session   Session   @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  placements Placement[]

  // 3. TYPE-SPECIFIC METADATA
  // Used for links (github, demo) or other arbitrary data 
  metadata     Json?     

  @@index([sessionId])
  @@index([type])
}

model Narrative {
  id           String     @id @default(uuid()) @db.Uuid
  experienceId String     @db.Uuid
  experience   Experience @relation(fields: [experienceId], references: [id], onDelete: Cascade)

  // PERSPECTIVE
  kind         String     // e.g., "visual-story", "technical-deep-dive", "quick-bio"
  slug         String?    // For clean URLs like /portfolio/my-project/technical

  // CONTENT
  headline     String?    // A punchy title for this specific narrative
  bodyContent  String?    @db.Text
  bulletPoints String[] 
  tags         String[]   // Technologies, themes, or moods

  @@index([experienceId])
}


model Session {
  id        String     @id @default(uuid()) @db.Uuid
  createdAt DateTime   @default(now())
  claimedByUserId String? @db.Uuid
  claimedBy   User?    @relation(fields: [claimedByUserId], references: [id], onDelete: SetNull)

  experiences Experience[]
  layouts      Layout[]   // <- singular

  profile Profile?

  @@index([claimedByUserId])
}

model Layout {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sessionId String   @db.Uuid
  session   Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  LayoutId  String   @default  ("home")

  slots Slot[]
  placements Placement[]

  @@unique([sessionId, LayoutId])
  @@index([LayoutId])
}

model Placement {
  id     String     @id @default(uuid()) @db.Uuid // Db internal 
  createdAt   DateTime  @default(now())

  layoutId  String  @db.Uuid
  layout    Layout  @relation(fields: [layoutId], references: [id], onDelete: Cascade)

  // RELATIONAL LINK
  experienceId String?     @db.Uuid
  experience   Experience? @relation(fields: [experienceId], references: [id], onDelete: Cascade)

  profileId    String?     @db.Uuid
  profile      Profile?    @relation(fields: [profileId], references: [id], onDelete: Cascade)



  // HUMAN READABLE KEYS (What the user edits in JSON)
  slotId       String     // e.g., "header-slot"
  patternId    String     // e.g., "hero-banner"

  @@index([layoutId])
  @@index([profileId]) // helpful for query performance 
}

model Slot{
  id  String  @id @default(uuid())  @db.Uuid
  layoutId    String  @db.Uuid
  layout   Layout   @relation(fields: [layoutId], references: [id], onDelete: Cascade)

  clientSlotId String //  e.g., "slot-1", "header" from your JSON
  area         String // e.g., "sidebar"

  @@index([layoutId])
}


