// datasource + generator
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ---------- Enums ----------
enum ExperienceKind {
  WORK
  PROJECT
  EDUCATION
  AWARD
  OTHER
}

// ---------- Models ----------
model User {
  id        String      @id @default(uuid()) @db.Uuid
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  // Relationships
  sessions  Session[]
  experiences Experience[]
  layouts   Layout[]

  // For future auth fields (email, provider IDs, etc.)
  // email     String?   @unique
}

model Session {
  id        String     @id @default(uuid()) @db.Uuid
  createdAt DateTime   @default(now())
  claimedByUserId String? @db.Uuid
  claimedBy   User?    @relation(fields: [claimedByUserId], references: [id], onDelete: SetNull)

  // Relationships
  experiences Experience[]
  layouts     Layout[]

  @@index([claimedByUserId])
}

model Experience {
  id        String     @id @default(uuid()) @db.Uuid
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  sessionId String?    @db.Uuid
  userId    String?    @db.Uuid

  session   Session?   @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  user      User?      @relation(fields: [userId], references: [id], onDelete: SetNull)

  title     String
  summary   String?
  start     DateTime?
  end       DateTime?
  kind      ExperienceKind @default(OTHER)

  // Postgres supports scalar lists; @db.Text specifies element type
  tags      String[]   @db.Text

  @@index([sessionId])
  @@index([userId])
  @@index([kind])
  @@index([title])
}

model Layout {
  id        String     @id @default(uuid()) @db.Uuid
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  sessionId String?    @db.Uuid
  userId    String?    @db.Uuid

  session   Session?   @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  user      User?      @relation(fields: [userId], references: [id], onDelete: SetNull)

  templateId String
  theme      String?

  // JSON payloads for flexible MVP structures
  slots       Json      @default("{}")
  placements  Json      @default("{}")

  @@index([sessionId])
  @@index([userId])
  @@index([templateId])
}
